<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Tira de Fotos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        canvas {
            border: 1px solid #ccc;
            background: white;
        }
    </style>
</head>
<body>
    <h1>Generador de Tira de Fotos</h1>
    <input type="file" id="fileInput" accept="image/*" multiple><br><br>
    <button onclick="generarTira()">Generar Tira</button>
    <button onclick="descargarTira()">Descargar</button>
    <br><br>
    <canvas id="canvas" width="1200" height="1800"></canvas>

    <script>
        let imagenes = [];
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function generarTira() {
            const archivos = document.getElementById('fileInput').files;
            if (archivos.length < 6) {
                alert('Selecciona al menos 6 fotos.');
                return;
            }

            imagenes = [];
            let cargadas = 0;

            // Cargar marco primero
            const marco = new Image();
            marco.src = 'marco.png';
            marco.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(marco, 0, 0, canvas.width, canvas.height);

                for (let i = 0; i < 6; i++) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.src = e.target.result;
                        img.onload = () => {
                            imagenes[i] = img;
                            cargadas++;
                            if (cargadas === 6) {
                                dibujarFotos();
                            }
                        };
                    };
                    reader.readAsDataURL(archivos[i]);
                }
            };
        }

        function dibujarFotos() {
            const anchoFoto = canvas.width / 2;
            const altoFoto = canvas.height / 3;

            imagenes.forEach((img, i) => {
                const x = (i < 3) ? 0 : anchoFoto;
                const y = (i % 3) * altoFoto;

                // Calcular recorte proporcional
                const escala = Math.max(anchoFoto / img.width, altoFoto / img.height);
                const nuevoAncho = img.width * escala;
                const nuevoAlto = img.height * escala;
                const offsetX = (anchoFoto - nuevoAncho) / 2 * 0.7;
                const offsetY = (altoFoto - nuevoAlto) / 2 * 0.7;

                ctx.drawImage(img, x + offsetX, y + offsetY, nuevoAncho, nuevoAlto);
            });
        }

        function descargarTira() {
            const enlace = document.createElement('a');
            enlace.download = 'tira_fotos.png';
            enlace.href = canvas.toDataURL('image/png');
            enlace.click();
        }
    </script>
</body>
</html>
