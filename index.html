<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Tira con Marco</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #eee;
        }
        canvas {
            border: 1px solid #ccc;
            background: white;
        }
    </style>
</head>
<body>
    <h2>Generador de Tira con Marco</h2>
    <input type="file" id="fileInput" accept="image/*" multiple>
    <br><br>
    <button onclick="generar()">Generar</button>
    <button onclick="descargar()">Descargar</button>
    <br><br>
    <canvas id="canvas" width="1200" height="1800"></canvas>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        const marco = new Image();
        marco.src = "marco.png"; // Debe estar en la misma carpeta del HTML

        let fotos = [];

        document.getElementById("fileInput").addEventListener("change", function (e) {
            fotos = [];
            const files = Array.from(e.target.files).slice(0, 6); // Solo 6 fotos
            files.forEach(file => {
                const img = new Image();
                img.src = URL.createObjectURL(file);
                fotos.push(img);
            });
        });

        function generar() {
            if (fotos.length === 0) {
                alert("Sube primero tus fotos (máximo 6).");
                return;
            }

            marco.onload = () => {
                dibujar();
            };

            if (marco.complete) {
                dibujar();
            }
        }

        function dibujar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Fondo con el marco
            ctx.drawImage(marco, 0, 0, canvas.width, canvas.height);

            // Configuración de grilla para 6 fotos (2 filas x 3 columnas)
            const cols = 3;
            const rows = 2;
            const fotoAncho = 1200 / cols;
            const fotoAlto = 500; // área útil para fotos
            const margenY = 400; // posición inicial Y para la primera fila
            const espacioVertical = 550; // distancia entre filas

            fotos.forEach((img, i) => {
                img.onload = () => colocarFoto(img, i, cols, fotoAncho, fotoAlto, margenY, espacioVertical);
                if (img.complete) {
                    colocarFoto(img, i, cols, fotoAncho, fotoAlto, margenY, espacioVertical);
                }
            });
        }

        function colocarFoto(img, index, cols, ancho, alto, margenY, espacioVertical) {
            const col = index % cols;
            const row = Math.floor(index / cols);
            const x = col * ancho;
            const y = margenY + row * espacioVertical;

            // Recorte proporcional
            const ratioImg = img.width / img.height;
            const ratioCaja = ancho / alto;
            let sx, sy, sw, sh;

            if (ratioImg > ratioCaja) {
                // Imagen más ancha que la caja
                sh = img.height;
                sw = sh * ratioCaja;
                sx = (img.width - sw) / 2;
                sy = 0;
            } else {
                // Imagen más alta que la caja
                sw = img.width;
                sh = sw / ratioCaja;
                sx = 0;
                sy = (img.height - sh) / 2;
            }

            ctx.drawImage(img, sx, sy, sw, sh, x, y, ancho, alto);
        }

        function descargar() {
            const enlace = document.createElement("a");
            enlace.download = "tira.png";
            enlace.href = canvas.toDataURL("image/png");
            enlace.click();
        }
    </script>
</body>
</html>

