<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Generador de Tira de Fotos Mejorado</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #6e8efb, #a777e3);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    h1 {
      margin-bottom: 20px;
      color: #2c3e50;
      font-size: 2.2rem;
    }
    
    .description {
      margin-bottom: 25px;
      color: #555;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    
    .upload-container {
      background: #f8f9fa;
      border: 2px dashed #6c757d;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }
    
    .upload-container:hover {
      background: #e9ecef;
      border-color: #4e73df;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    button {
      padding: 12px 25px;
      background: #4e73df;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    button:hover {
      background: #2e59d9;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    #btnDescargar {
      background: #1cc88a;
    }
    
    #btnDescargar:hover {
      background: #17a673;
    }
    
    .canvas-container {
      margin: 20px auto;
      width: 100%;
      overflow: auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 10px;
    }
    
    canvas {
      display: block;
      margin: 0 auto;
      background: #fff;
      border: 1px solid #ddd;
    }
    
    .print-tips {
      margin-top: 25px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      text-align: left;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .print-tips h3 {
      margin-bottom: 10px;
      color: #2c3e50;
    }
    
    .print-tips ul {
      padding-left: 20px;
    }
    
    .print-tips li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    
    .thumbnail-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    
    .thumbnail {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #ddd;
    }
    
    .file-input-label {
      display: inline-block;
      padding: 12px 25px;
      background: #4e73df;
      color: white;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      margin-bottom: 15px;
    }
    
    .file-input-label:hover {
      background: #2e59d9;
    }
    
    input[type="file"] {
      display: none;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      button {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Generador de Tira de Fotos Mejorado</h1>
    
    <p class="description">Sube 6 fotos para crear una tira de fotos perfecta para imprimir. Las imágenes se ajustarán automáticamente al formato correcto.</p>
    
    <div class="upload-container">
      <label for="fileInput" class="file-input-label">Seleccionar Fotos</label>
      <input type="file" id="fileInput" accept="image/*" multiple>
      
      <div class="thumbnail-container" id="thumbnailContainer">
        <!-- Las miniaturas se mostrarán aquí -->
      </div>
    </div>
    
    <div class="controls">
      <button id="btnGenerar">Generar Tira</button>
      <button id="btnDescargar" disabled>Descargar</button>
    </div>
    
    <div class="canvas-container">
      <canvas id="canvas" width="1181" height="1772"></canvas>
    </div>
    
    <div class="print-tips">
      <h3>Consejos para una impresión perfecta:</h3>
      <ul>
        <li>Imprime en papel fotográfico para obtener los mejores resultados</li>
        <li>Asegúrate de que la configuración de impresión esté al 100% (sin escalado)</li>
        <li>Utiliza la opción "Ajustar a página" si la impresión no coincide perfectamente</li>
        <li>Verifica que la orientación de impresión sea vertical</li>
        <li>Si es posible, utiliza una impresora a color de alta calidad</li>
      </ul>
    </div>
  </div>

  <script>
    // Tamaño del lienzo
    const CANVAS_W = 1181;
    const CANVAS_H = 1772;

    // Posiciones fijas para las fotos
    const POSICIONES_MANUALES = [
      {x: 50, y: 310}, 
      {x: 50, y: 700},
      {x: 50, y: 1090},
      {x: 650, y: 310},
      {x: 650, y: 700},
      {x: 650, y: 1090}
    ];

    // Tamaño fijo de cada foto
    const ANCHO_FOTO = 500;
    const ALTO_FOTO = 360;

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = CANVAS_W;
    canvas.height = CANVAS_H;

    // Imágenes de fondo (simuladas con colores ya que no tenemos las imágenes reales)
    let imagenes = [];
    let imagenesCargadas = 0;

    // Referencias a elementos UI
    const fileInput = document.getElementById('fileInput');
    const btnGenerar = document.getElementById('btnGenerar');
    const btnDescargar = document.getElementById('btnDescargar');
    const thumbnailContainer = document.getElementById('thumbnailContainer');

    // Dibujar fondos simulados
    function dibujarFondosSimulados() {
      // Fondo blanco
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
      
      // Dibujar un marco simulado
      ctx.strokeStyle = '#4e73df';
      ctx.lineWidth = 15;
      ctx.strokeRect(20, 20, CANVAS_W - 40, CANVAS_H - 40);
      
      // Dibujar áreas para fotos
      ctx.fillStyle = 'rgba(78, 115, 223, 0.05)';
      POSICIONES_MANUALES.forEach(pos => {
        ctx.fillRect(pos.x, pos.y, ANCHO_FOTO, ALTO_FOTO);
      });
      
      // Dibujar texto de ejemplo
      ctx.fillStyle = '#333';
      ctx.font = '30px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Tira de Fotos - Ejemplo de diseño', CANVAS_W / 2, 150);
      ctx.font = '20px Arial';
      ctx.fillText('Tus fotos aparecerán en los recuadros azules', CANVAS_W / 2, 200);
    }

    // Inicializar con fondos simulados
    dibujarFondosSimulados();

    // Manejar la selección de archivos
    fileInput.addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      thumbnailContainer.innerHTML = '';
      
      if (files.length > 6) {
        alert('Solo puedes seleccionar hasta 6 fotos. Se usarán las primeras 6.');
      }
      
      // Habilitar/deshabilitar botones según la selección
      btnGenerar.disabled = files.length === 0;
      
      // Mostrar miniaturas
      files.slice(0, 6).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.classList.add('thumbnail');
          thumbnailContainer.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    // Generar la tira de fotos
    btnGenerar.addEventListener('click', generarTira);

    function generarTira() {
      const files = Array.from(fileInput.files).slice(0, 6);
      if (files.length < 6) {
        alert('Por favor, selecciona exactamente 6 fotos.');
        return;
      }

      imagenes = [];
      imagenesCargadas = 0;

      files.forEach((file, i) => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            imagenes[i] = img;
            imagenesCargadas++;
            
            if (imagenesCargadas === 6) {
              render();
              btnDescargar.disabled = false;
            }
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    function render() {
      // Limpiar el canvas
      ctx.clearRect(0, 0, CANVAS_W, CANVAS_H);
      
      // Dibujar fondo blanco
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
      
      // Dibujar marco simulado
      ctx.strokeStyle = '#4e73df';
      ctx.lineWidth = 15;
      ctx.strokeRect(20, 20, CANVAS_W - 40, CANVAS_H - 40);
      
      // Dibujar fotos
      for (let i = 0; i < 6; i++) {
        const pos = POSICIONES_MANUALES[i];
        if (imagenes[i]) {
          drawImageCover(ctx, imagenes[i], pos.x, pos.y, ANCHO_FOTO, ALTO_FOTO);
        }
      }
      
      // Dibujar superposición simulado
      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
      ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
      
      // Dibujar número en cada foto
      ctx.fillStyle = 'rgba(78, 115, 223, 0.8)';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      POSICIONES_MANUALES.forEach((pos, i) => {
        ctx.beginPath();
        ctx.arc(pos.x + ANCHO_FOTO - 30, pos.y + 30, 20, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.fillText((i + 1).toString(), pos.x + ANCHO_FOTO - 30, pos.y + 30);
        ctx.fillStyle = 'rgba(78, 115, 223, 0.8)';
      });
    }

    function drawImageCover(ctx, img, dx, dy, dW, dH) {
      const sW = img.width;
      const sH = img.height;
      const srcAR = sW / sH;
      const dstAR = dW / dH;

      let sx, sy, sw, sh;
      if (srcAR > dstAR) {
        sh = sH;
        sw = sh * dstAR;
        sx = (sW - sw) / 2;
        sy = 0;
      } else {
        sw = sW;
        sh = sw / dstAR;
        sx = 0;
        sy = (sH - sh) / 2;
      }
      ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dW, dH);
    }

    // Descargar la imagen
    btnDescargar.addEventListener('click', descargarBlob);

    function descargarBlob() {
      canvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'tira-de-fotos.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 'image/png');
    }
  </script>
</body>
</html>
