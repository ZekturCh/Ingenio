<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tira con Marco y Recorte</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f0f0f0;
        }
        canvas {
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        .input-group {
            margin: 10px;
        }
    </style>
    <!-- Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
</head>
<body>

<h2>Generar tira con recorte y marco</h2>

<div id="inputs"></div>
<button onclick="generarTira()">Generar Tira</button>
<br>
<canvas id="tiraCanvas" width="1200" height="1800"></canvas>
<br>
<a id="descargar" download="tira.png">Descargar Imagen</a>

<!-- LibrerÃ­a Cropper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script>
const totalFotos = 6;
const cropInstances = [];
const imagesData = [];

window.onload = () => {
    const inputsDiv = document.getElementById("inputs");
    for (let i = 0; i < totalFotos; i++) {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.className = "input-group";
        input.onchange = (e) => prepararCropper(e, i);
        inputsDiv.appendChild(input);
    }
};

function prepararCropper(e, index) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
        const image = document.createElement("img");
        image.src = event.target.result;
        image.style.maxWidth = "100%";

        const cropWindow = window.open("", "_blank", "width=600,height=600");
        cropWindow.document.write(`
            <html>
            <head>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
            </head>
            <body style="margin:0">
                <img id="image" src="${image.src}">
                <button id="cropBtn">Recortar</button>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
                <script>
                    const imageEl = document.getElementById('image');
                    const cropper = new Cropper(imageEl, {
                        aspectRatio: 500 / 399, 
                        viewMode: 1
                    });
                    document.getElementById('cropBtn').onclick = () => {
                        const canvas = cropper.getCroppedCanvas({ width: 500, height: 399 });
                        window.opener.imagesData[${index}] = canvas;
                        window.close();
                    };
                <\/script>
            </body>
            </html>
        `);
    };
    reader.readAsDataURL(file);
}

function generarTira() {
    const canvas = document.getElementById("tiraCanvas");
    const ctx = canvas.getContext("2d");

    const marco = new Image();
    marco.src = "marco.png"; // Debe estar en el mismo repo
    marco.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Dibujar marco al fondo
        ctx.drawImage(marco, 0, 0, canvas.width, canvas.height);

        // Posiciones para 2 columnas
        const posiciones = [
            {x: 100, y: 100},   // F1
            {x: 100, y: 550},   // F2
            {x: 100, y: 1000},  // F3
            {x: 650, y: 100},   // F4
            {x: 650, y: 550},   // F5
            {x: 650, y: 1000}   // F6
        ];

        for (let i = 0; i < totalFotos; i++) {
            if (imagesData[i]) {
                ctx.drawImage(imagesData[i], posiciones[i].x, posiciones[i].y, 500, 399);
            }
        }

        // Actualizar enlace de descarga
        document.getElementById("descargar").href = canvas.toDataURL("image/png");
    };
}
</script>
</body>
</html>

