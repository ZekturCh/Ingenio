<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Generador de Tiras para iPhone</title>
  <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0OCIgZmlsbD0iIzRlNzNkZiIvPjxwYXRoIGQ9Ik02NSw0MGMwLTMuMy0yLjctNi02LTZzLTYsMi43LTYsNnMyLjcsNiw2LDZTNjUsNDMuMyw2NSw0MHogTTQ3LDYzVjM3aDZ2MjZINDd6IiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #6e8efb, #a777e3);
      margin: 0;
      padding: 15px;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      width: 100%;
      max-width: 500px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      margin: 20px 0;
    }
    
    h1 {
      margin-bottom: 15px;
      color: #2c3e50;
      font-size: 1.7rem;
      font-weight: 700;
    }
    
    .description {
      margin-bottom: 20px;
      color: #555;
      line-height: 1.5;
      font-size: 0.95rem;
    }
    
    .upload-container {
      background: #f8f9fa;
      border: 2px dashed #6c757d;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }
    
    .upload-container:hover {
      background: #e9ecef;
      border-color: #4e73df;
    }
    
    .file-input-label {
      display: inline-block;
      padding: 14px 28px;
      background: #4e73df;
      color: white;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      margin: 10px 0;
      font-size: 1rem;
    }
    
    .file-input-label:active {
      transform: scale(0.98);
      background: #2e59d9;
    }
    
    input[type="file"] {
      display: none;
    }
    
    .thumbnail-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin: 15px 0;
    }
    
    .thumbnail {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #ddd;
    }
    
    .status-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
      align-items: center;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      background: #f8f9fa;
      padding: 10px 18px;
      border-radius: 50px;
      font-size: 13px;
      width: fit-content;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-loaded {
      background: #1cc88a;
    }
    
    .status-loading {
      background: #f6c23e;
    }
    
    .status-error {
      background: #e74a3b;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    button {
      padding: 14px 28px;
      background: #4e73df;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
    }
    
    button:active {
      transform: scale(0.96);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    #btnDescargar {
      background: #1cc88a;
    }
    
    #btnDescargar:active:not(:disabled) {
      background: #17a673;
    }
    
    .canvas-container {
      margin: 15px auto;
      width: 100%;
      overflow: auto;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 12px;
    }
    
    canvas {
      display: block;
      margin: 0 auto;
      background: #fff;
      border: 1px solid #ddd;
      max-width: 100%;
      height: auto;
    }
    
    .instructions {
      margin-top: 20px;
      padding: 18px;
      background: #f8f9fa;
      border-radius: 14px;
      text-align: left;
      font-size: 0.9rem;
    }
    
    .instructions h3 {
      margin-bottom: 10px;
      color: #2c3e50;
      text-align: center;
      font-size: 1.1rem;
    }
    
    .instructions ol {
      padding-left: 18px;
    }
    
    .instructions li {
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    .ios-tip {
      display: none;
      background: #e8f4fd;
      border-radius: 12px;
      padding: 12px;
      margin-top: 12px;
      text-align: center;
      font-size: 0.85rem;
    }
    
    /* Detecci칩n de iOS */
    @supports (-webkit-touch-callout: none) {
      .ios-tip {
        display: block;
      }
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 15px;
        border-radius: 16px;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .file-input-label, button {
        padding: 12px 24px;
        font-size: 0.95rem;
      }
      
      .thumbnail {
        width: 55px;
        height: 55px;
      }
      
      .instructions {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Generador de Tiras para iPhone</h1>
    
    <p class="description">Selecciona 6 fotos para crear una tira. Las im치genes de fondo se cargan autom치ticamente.</p>
    
    <div class="upload-container">
      <label for="fileInput" class="file-input-label">Seleccionar 6 Fotos</label>
      <input type="file" id="fileInput" accept="image/*" multiple>
      
      <div class="thumbnail-container" id="thumbnailContainer">
        <!-- Las miniaturas se mostrar치n aqu칤 -->
      </div>
    </div>

    <div class="status-container">
      <div class="status-item">
        <span class="status-indicator" id="statusFondoIndicator"></span>
        <span id="statusFondoText">Fondo: Cargando...</span>
      </div>
      <div class="status-item">
        <span class="status-indicator" id="statusSobreIndicator"></span>
        <span id="statusSobreText">Superposici칩n: Cargando...</span>
      </div>
      <div class="status-item">
        <span class="status-indicator" id="statusFotosIndicator"></span>
        <span id="statusFotosText">Fotos: 0/6</span>
      </div>
    </div>
    
    <div class="controls">
      <button id="btnGenerar">Generar Tira</button>
      <button id="btnDescargar" disabled>Guardar en Fotos</button>
    </div>
    
    <div class="canvas-container">
      <canvas id="canvas" width="900" height="1400"></canvas>
    </div>
    
    <div class="ios-tip">
      <p>游눠 <strong>Para guardar en Fotos:</strong> Mant칠n presionada la imagen y selecciona "Guardar imagen"</p>
    </div>
    
    <div class="instructions">
      <h3>Instrucciones para iPhone</h3>
      <ol>
        <li>Selecciona 6 fotos con el bot칩n "Seleccionar 6 Fotos"</li>
        <li>Presiona "Generar Tira" para crear tu dise침o</li>
        <li>Usa el bot칩n "Guardar en Fotos" para guardar en tu galer칤a</li>
        <li>Si el bot칩n no funciona, mant칠n presionada la imagen y selecciona "Guardar imagen"</li>
      </ol>
    </div>
  </div>

  <script>
    // Tama침o del lienzo ajustado a 900x1400
    const CANVAS_W = 900;
    const CANVAS_H = 1400;

    // Posiciones fijas para las fotos (ajustadas para el nuevo tama침o 900x1400)
    const POSICIONES_MANUALES = [
      {x: 35, y: 245}, 
      {x: 35, y: 540},
      {x: 35, y: 835},
      {x: 470, y: 245},
      {x: 470, y: 540},
      {x: 470, y: 835}
    ];

    // Tama침o fijo de cada foto (ajustado para el nuevo tama침o)
    const ANCHO_FOTO = 380;
    const ALTO_FOTO = 275;

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = CANVAS_W;
    canvas.height = CANVAS_H;

    // Im치genes
    let imagenes = [];
    let imagenFondo = null;
    let imagenSobre = null;

    // Referencias a elementos UI
    const fileInput = document.getElementById('fileInput');
    const btnGenerar = document.getElementById('btnGenerar');
    const btnDescargar = document.getElementById('btnDescargar');
    const thumbnailContainer = document.getElementById('thumbnailContainer');
    const statusFondoIndicator = document.getElementById('statusFondoIndicator');
    const statusFondoText = document.getElementById('statusFondoText');
    const statusSobreIndicator = document.getElementById('statusSobreIndicator');
    const statusSobreText = document.getElementById('statusSobreText');
    const statusFotosIndicator = document.getElementById('statusFotosIndicator');
    const statusFotosText = document.getElementById('statusFotosText');

    // Detectar si es iOS
    function esIOS() {
      return [
        'iPad Simulator',
        'iPhone Simulator',
        'iPod Simulator',
        'iPad',
        'iPhone',
        'iPod'
      ].includes(navigator.platform) || 
      (navigator.userAgent.includes("Mac") && "ontouchend" in document);
    }

    // Cargar im치genes de fondo y superposici칩n autom치ticamente
    function cargarImagenesAutomaticas() {
      // Cargar fondo
      imagenFondo = new Image();
      imagenFondo.onload = function() {
        statusFondoIndicator.className = 'status-indicator status-loaded';
        statusFondoText.textContent = 'Fondo: Cargado';
        console.log('Fondo cargado correctamente');
        
        // Redimensionar fondo para que encaje en 900x1400
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = CANVAS_W;
        tempCanvas.height = CANVAS_H;
        
        // Dibujar fondo redimensionado
        tempCtx.drawImage(imagenFondo, 0, 0, CANVAS_W, CANVAS_H);
        
        // Crear nueva imagen con el tama침o correcto
        const resizedFondo = new Image();
        resizedFondo.onload = function() {
          imagenFondo = resizedFondo;
          dibujarVistaInicial();
        };
        resizedFondo.src = tempCanvas.toDataURL('image/png');
      };
      imagenFondo.onerror = function() {
        statusFondoIndicator.className = 'status-indicator status-error';
        statusFondoText.textContent = 'Fondo: Error al cargar';
        console.error('Error al cargar el fondo. Aseg칰rate de que fondo2.png est치 en la misma carpeta.');
        
        // Crear un fondo blanco como respaldo
        dibujarVistaInicial();
      };
      imagenFondo.crossOrigin = "anonymous";
      imagenFondo.src = 'fondo2.png';

      // Cargar superposici칩n
      imagenSobre = new Image();
      imagenSobre.onload = function() {
        statusSobreIndicator.className = 'status-indicator status-loaded';
        statusSobreText.textContent = 'Superposici칩n: Cargada';
        console.log('Superposici칩n cargada correctamente');
        
        // Redimensionar superposici칩n para que encaje en 900x1400
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = CANVAS_W;
        tempCanvas.height = CANVAS_H;
        
        // Dibujar superposici칩n redimensionada
        tempCtx.drawImage(imagenSobre, 0, 0, CANVAS_W, CANVAS_H);
        
        // Crear nueva imagen con el tama침o correcto
        const resizedSobre = new Image();
        resizedSobre.onload = function() {
          imagenSobre = resizedSobre;
        };
        resizedSobre.src = tempCanvas.toDataURL('image/png');
      };
      imagenSobre.onerror = function() {
        statusSobreIndicator.className = 'status-indicator status-error';
        statusSobreText.textContent = 'Superposici칩n: Error al cargar';
        console.error('Error al cargar la superposici칩n. Aseg칰rate de que over.png est치 en la misma carpeta.');
      };
      imagenSobre.crossOrigin = "anonymous";
      imagenSobre.src = 'over.png';
    }

    // Dibujar vista inicial
    function dibujarVistaInicial() {
      // Fondo blanco
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
      
      // Dibujar 치reas para fotos (solo para visualizaci칩n)
      ctx.fillStyle = 'rgba(78, 115, 223, 0.05)';
      POSICIONES_MANUALES.forEach(pos => {
        ctx.fillRect(pos.x, pos.y, ANCHO_FOTO, ALTO_FOTO);
      });
      
      // Dibujar texto de ejemplo
      ctx.fillStyle = '#333';
      ctx.font = '22px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Generador de Tira de Fotos', CANVAS_W / 2, 120);
      ctx.font = '16px Arial';
      ctx.fillText('Selecciona 6 fotos para comenzar', CANVAS_W / 2, 150);
    }

    // Inicializar
    cargarImagenesAutomaticas();

    // Manejar la selecci칩n de archivos
    fileInput.addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      thumbnailContainer.innerHTML = '';
      
      if (files.length > 6) {
        alert('Solo puedes seleccionar hasta 6 fotos. Se usar치n las primeras 6.');
      }
      
      // Actualizar estado
      const loadedCount = Math.min(files.length, 6);
      statusFotosIndicator.className = `status-indicator ${loadedCount > 0 ? 'status-loaded' : 'status-loading'}`;
      statusFotosText.textContent = `Fotos: ${loadedCount}/6`;
      
      // Habilitar/deshabilitar botones seg칰n la selecci칩n
      btnGenerar.disabled = files.length < 6;
      
      // Mostrar miniaturas
      files.slice(0, 6).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.classList.add('thumbnail');
          thumbnailContainer.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    // Generar la tira de fotos
    btnGenerar.addEventListener('click', generarTira);

    function generarTira() {
      const files = Array.from(fileInput.files).slice(0, 6);
      if (files.length < 6) {
        alert('Por favor, selecciona exactamente 6 fotos.');
        return;
      }

      imagenes = [];
      let imagenesCargadas = 0;

      files.forEach((file, i) => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            imagenes[i] = img;
            imagenesCargadas++;
            
            if (imagenesCargadas === 6) {
              render();
              btnDescargar.disabled = false;
            }
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    function render() {
      // Limpiar el canvas
      ctx.clearRect(0, 0, CANVAS_W, CANVAS_H);
      
      // Dibujar fondo (imagen cargada o blanco por defecto)
      if (imagenFondo && imagenFondo.complete && imagenFondo.naturalHeight !== 0) {
        ctx.drawImage(imagenFondo, 0, 0, CANVAS_W, CANVAS_H);
      } else {
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
      }
      
      // Dibujar fotos
      for (let i = 0; i < 6; i++) {
        const pos = POSICIONES_MANUALES[i];
        if (imagenes[i]) {
          drawImageCover(ctx, imagenes[i], pos.x, pos.y, ANCHO_FOTO, ALTO_FOTO);
        }
      }
      
      // Dibujar superposici칩n si est치 cargada
      if (imagenSobre && imagenSobre.complete && imagenSobre.naturalHeight !== 0) {
        ctx.drawImage(imagenSobre, 0, 0, CANVAS_W, CANVAS_H);
      }
    }

    function drawImageCover(ctx, img, dx, dy, dW, dH) {
      const sW = img.width;
      const sH = img.height;
      const srcAR = sW / sH;
      const dstAR = dW / dH;

      let sx, sy, sw, sh;
      if (srcAR > dstAR) {
        sh = sH;
        sw = sh * dstAR;
        sx = (sW - sw) / 2;
        sy = 0;
      } else {
        sw = sW;
        sh = sw / dstAR;
        sx = 0;
        sy = (sH - sh) / 2;
      }
      ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dW, dH);
    }

    // Guardar la imagen en Fotos (para iOS)
    btnDescargar.addEventListener('click', guardarEnFotos);

    function guardarEnFotos() {
      // Crear un canvas temporal
      const tempCanvas = document.createElement('canvas');
      const tempCtx = tempCanvas.getContext('2d');
      tempCanvas.width = CANVAS_W;
      tempCanvas.height = CANVAS_H;
      
      // Dibujar el fondo
      if (imagenFondo && imagenFondo.complete && imagenFondo.naturalHeight !== 0) {
        tempCtx.drawImage(imagenFondo, 0, 0, CANVAS_W, CANVAS_H);
      } else {
        tempCtx.fillStyle = '#fff';
        tempCtx.fillRect(0, 0, CANVAS_W, CANVAS_H);
      }
      
      // Dibujar las fotos
      for (let i = 0; i < 6; i++) {
        const pos = POSICIONES_MANUALES[i];
        if (imagenes[i]) {
          const img = imagenes[i];
          const sW = img.width;
          const sH = img.height;
          const srcAR = sW / sH;
          const dstAR = ANCHO_FOTO / ALTO_FOTO;

          let sx, sy, sw, sh;
          if (srcAR > dstAR) {
            sh = sH;
            sw = sh * dstAR;
            sx = (sW - sw) / 2;
            sy = 0;
          } else {
            sw = sW;
            sh = sw / dstAR;
            sx = 0;
            sy = (sH - sh) / 2;
          }
          tempCtx.drawImage(img, sx, sy, sw, sh, pos.x, pos.y, ANCHO_FOTO, ALTO_FOTO);
        }
      }
      
      // Dibujar la superposici칩n
      if (imagenSobre && imagenSobre.complete && imagenSobre.naturalHeight !== 0) {
        tempCtx.drawImage(imagenSobre, 0, 0, CANVAS_W, CANVAS_H);
      }
      
      // Convertir a data URL
      const dataURL = tempCanvas.toDataURL('image/png');
      
      // Para iOS, mostramos la imagen y permitimos guardar manteniendo presionado
      if (esIOS()) {
        // Crear una imagen para mostrar
        const imgElement = document.createElement('img');
        imgElement.src = dataURL;
        imgElement.style.maxWidth = '100%';
        imgElement.style.marginTop = '15px';
        imgElement.style.borderRadius = '8px';
        imgElement.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
        
        // Reemplazar el canvas con la imagen
        const canvasContainer = document.querySelector('.canvas-container');
        canvasContainer.innerHTML = '';
        canvasContainer.appendChild(imgElement);
        
        // Mostrar instrucciones para guardar
        alert('Mant칠n presionada la imagen y selecciona "Guardar imagen" para guardar en Fotos.');
      } else {
        // Para otros dispositivos, descarga normal
        const a = document.createElement('a');
        a.href = dataURL;
        a.download = 'tira-de-fotos.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
    }

    // A침adir evento de toque para iOS
    if (esIOS()) {
      canvas.addEventListener('touchstart', function() {
        if (!btnDescargar.disabled) {
          guardarEnFotos();
        }
      });
    }
  </script>
</body>
</html>
